# ACP 扩展架构设计

## 项目概述

ACP 扩展是一个基于 WXT 框架开发的浏览器扩展，专为提升 ACP (Application Container Platform) 和 DataServices 平台的使用体验而设计。扩展提供了集群/命名空间快速切换、kubectl 终端快速访问等功能。

## 技术栈

### 核心框架
- **WXT**: 现代化的 Web Extension 开发框架
- **Vue 3**: 用于构建用户界面的渐进式 JavaScript 框架
- **TypeScript**: 提供类型安全的 JavaScript 超集
- **Composition API**: Vue 3 的组合式 API，提供更好的逻辑复用

### 构建工具
- **Vite**: 快速的前端构建工具（WXT 内置）
- **vue-tsc**: Vue TypeScript 编译器
- **Bun**: 包管理器和运行时

## 项目结构

```
acp-ext/
├── assets/                    # 静态资源
│   └── vue.svg
├── components/                # Vue 组件
│   ├── HelloWorld.vue        # 示例组件
│   ├── Options.vue           # 配置页面主组件
│   ├── Switch.vue            # 集群/命名空间选择器
│   └── Tools.vue             # 工具集合组件
├── composables/               # 可组合函数
│   ├── kubectl-handler.ts    # kubectl 功能处理
│   ├── toast.ts              # 通知提示功能
│   └── url-handler.ts        # URL 解析和生成
├── docs/                      # 项目文档
│   └── 架构设计.md
├── entrypoints/               # 扩展入口点
│   ├── background.ts          # 后台脚本
│   ├── options/               # 配置页面
│   │   ├── index.html
│   │   ├── main.ts
│   │   └── style.css
│   └── popup/                 # 弹出窗口
│       ├── App.vue
│       ├── index.html
│       ├── main.ts
│       └── style.css
├── public/                    # 公共资源
│   └── icon/                  # 扩展图标
│       ├── 16.png
│       ├── 32.png
│       ├── 48.png
│       ├── 96.png
│       └── 128.png
├── package.json
├── tsconfig.json
└── wxt.config.ts              # WXT 配置文件
```

## 核心模块设计

### 1. Manifest 配置
```typescript
// wxt.config.ts
{
  name: 'ACP 扩展',
  description: 'ACP 扩展工具, 提升非功能性的使用体验',
  permissions: ['tabs', 'storage', 'activeTab'],
  action: { default_popup: 'popup.html' },
  options_page: 'options.html',
  commands: {
    'open-kubectl': {
      description: '打开 kubectl 页面'
    }
  }
}
```

### 2. 后台服务 (Background Script)
**文件**: `entrypoints/background.ts`

**职责**:
- 扩展安装时初始化默认配置
- 处理快捷键命令
- 管理扩展生命周期

**核心功能**:
```typescript
// 默认配置初始化
const defaultOptions = {
  clusterOptions: ['global'],
  namespaceOptions: ['kube-system', 'cpaas-system'],
  kubectlOpenType: 'tab'
};

// 快捷键处理
browser.commands.onCommand.addListener(async (command) => {
  if (command === 'open-kubectl') {
    // 执行 kubectl 快速访问逻辑
  }
});
```

### 3. 弹出窗口 (Popup)
**文件**: `entrypoints/popup/App.vue`

**设计特点**:
- 固定尺寸 (400x520px) 避免页面跳动
- 选项卡式导航 (切换/工具)
- 响应式交互反馈

**页面结构**:
```
┌─────────────────────────────┐
│    🔧 ACP 扩展 (头部)        │
├─────────────────────────────┤
│  [切换] [工具] (导航栏)      │
├─────────────────────────────┤
│                             │
│       内容区域               │
│   (固定高度+滚动)            │
│                             │
├─────────────────────────────┤
│     操作按钮区               │
└─────────────────────────────┘
```

### 4. 配置页面 (Options)
**文件**: `entrypoints/options/`

**功能**:
- 集群选项管理 (增删改、拖拽排序)
- 命名空间选项管理
- kubectl 打开方式配置
- 配置导入导出
```

**功能流程**:
1. 检测当前页面是否为控制台页面
2. 提取基础 URL
3. 构造 kubectl 终端页面 URL
4. 根据用户配置打开方式导航

**打开方式**:
- `current`: 当前标签页跳转
- `tab`: 新标签页打开
- `window`: 新窗口打开

## 组件设计

### 1. Switch 组件
**功能**: 集群/命名空间选择器
**特性**:
- 下拉搜索过滤
- 当前选项和自定义输入支持
- 选中状态视觉反馈
- 键盘导航支持

### 2. Tools 组件
**功能**: 快捷工具集合
**当前工具**:
- kubectl 终端快速访问

**设计模式**: 卡片式布局，易于扩展新工具

### 3. Options 组件
**功能**: 全屏配置管理
**特性**:
- 拖拽排序
- 实时保存
- 批量操作
- 导入导出功能

## 数据流架构

```
用户操作 → Popup/Options → Composables → Browser APIs → Storage/Tabs
     ↓                                    ↓
   UI反馈 ← Toast通知 ← 错误处理 ← 业务逻辑处理
```

## 扩展性设计

### 1. 新平台支持
通过扩展 `url-handler.ts` 中的 URL_TYPE 和相应的处理函数即可支持新平台。

### 2. 新工具添加
在 `Tools.vue` 中的工具数组中添加新的工具定义即可。

### 3. 配置扩展
通过扩展 `StorageData` 接口和相应的 UI 组件即可添加新的配置项。

## 部署与分发

### 构建命令
```bash
# 开发模式
npm run dev              # Chrome/Edge
npm run dev:firefox      # Firefox

# 生产构建
npm run build            # Chrome/Edge
npm run build:firefox    # Firefox

# 打包分发
npm run zip              # Chrome/Edge
npm run zip:firefox      # Firefox
```

## 版本规划

### v0.0.1
- ✅ 集群/命名空间快速切换
- ✅ kubectl 终端快速访问
- ✅ 配置管理界面

